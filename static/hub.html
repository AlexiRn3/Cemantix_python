<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Arcade Hub</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">
    <header class="hero">
        <p class="eyebrow" style="color: var(--accent); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; margin-bottom: 10px;">Plateforme de Jeux</p>
        <h1>ARCADE HUB.</h1>
        <p>Une collection minimaliste de jeux de mots et de s√©mantique. Connectez-vous, choisissez votre d√©fi et jouez en temps r√©el.</p>
        
        <div style="margin-top: 40px; display: grid; grid-template-columns: 1fr 1fr auto; gap: 20px; max-width: 700px;">
            <input type="text" id="player-name" placeholder="Votre Pseudo *" />
            <input type="text" id="room-id" placeholder="Code Room (optionnel)" />
            <button id="btn-join" class="btn btn-outline">Rejoindre</button>
        </div>
    </header>

    <div class="games-grid">
        <article class="game-card">
            <div>
                <div class="game-icon" style="color: #ff3c00;">‚ú¶</div>
                <h3>C√©mantix</h3>
                <p>Le classique. Trouvez le mot cach√© gr√¢ce √† la proximit√© s√©mantique. Un algorithme de NLP vous guide vers la victoire.</p>
            </div>
            <button class="btn" onclick="createGame('cemantix')">Lancer le protocole</button>
        </article>

        <article class="game-card">
            <div>
                <div class="game-icon" style="color: #00e054;">¬∂</div>
                <h3>Dictionnario</h3>
                <p>D√©duction pure. Analysez la d√©finition.</p>
                </div>
            <button class="btn" onclick="openDictioConfig()">Configurer & Jouer</button>
        </article>

        <article class="game-card">
        <div>
            <div class="game-icon" style="color: #6c5ce7;">?</div>
            <h3>L'Intrus</h3>
            <p>Un de ces 4 mots n'a rien √† faire l√†. Serez-vous assez fin pour rep√©rer l'intrus s√©mantique ?</p>
        </div>
        <button class="btn" onclick="openGameConfig('intruder')">Chrono & Jouer</button>
    </article>
    </div>
</div>

<div id="modal-overlay" class="modal-overlay">
    <div class="modal-box">
        <div id="modal-title" class="modal-title">Titre</div>
        <div id="modal-content" class="modal-content">Contenu</div>
        <div class="modal-actions">
            <button class="btn" onclick="closeModal()">Fermer</button>
        </div>
    </div>
</div>

<script>

let currentConfigType = "definition"; // 'definition' ou 'intruder'

function openGameConfig(type) {
    if (!verifierPseudo()) return;
    
    currentConfigType = type;
    const modal = document.getElementById('config-modal');
    const modeGroup = document.getElementById('mode-group');
    const durationGroup = document.getElementById('duration-group');
    const title = document.getElementById('config-modal-title');
    const desc = document.getElementById('mode-desc');
    const modeSelect = document.getElementById('config-mode');

    modal.classList.add('active');

    if (type === 'intruder') {
        // --- CONFIGURATION INTRUS (Timer Obligatoire) ---
        title.textContent = "L'Intrus : Contre la montre";
        
        // On cache le choix du mode car c'est forc√© en Blitz
        modeGroup.style.display = 'none'; 
        modeSelect.value = 'blitz'; // Force la valeur interne
        
        // On affiche toujours la dur√©e
        durationGroup.style.display = 'block';
        
        desc.textContent = "Trouvez un maximum d'intrus avant la fin du temps imparti !";
    } else {
        // --- CONFIGURATION DICTIONNARIO (Choix Libre) ---
        title.textContent = "Config. Dictionnario";
        
        // On affiche le choix du mode
        modeGroup.style.display = 'block';
        modeSelect.value = 'coop'; // D√©faut
        
        toggleDurationDisplay(); // G√®re l'affichage de la dur√©e selon le mode choisi
    }
}
// Logique Modale
function showModal(title, message) {
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-content').textContent = message;
    document.getElementById('modal-overlay').classList.add('active');
}
function closeModal() {
    document.getElementById('modal-overlay').classList.remove('active');
}

// 1. Ouvrir la modale
function openDictioConfig() {
    if (!verifierPseudo()) return;
    const modal = document.getElementById('config-modal');
    modal.classList.add('active');
    // Reset √† l'√©tat par d√©faut (Coop)
    document.getElementById('config-mode').value = "coop";
    toggleDurationDisplay();
}

// 2. Fermer la modale
function closeConfigModal() {
    document.getElementById('config-modal').classList.remove('active');
}

function verifierPseudo() {
    const nameInput = document.getElementById('player-name');
    const name = nameInput.value.trim();

    if (!name) {
        // 1. On met le focus sur le champ (le navigateur scroll vers lui si besoin)
        nameInput.focus();
        
        // 2. On ajoute l'animation "error-shake" d√©finie dans ton style.css
        nameInput.classList.add('error-shake');
        
        // 3. On retire la classe apr√®s l'animation pour pouvoir la rejouer si besoin
        setTimeout(() => nameInput.classList.remove('error-shake'), 500);
        
        return false; // Le pseudo est invalide
    }
    return true; // C'est tout bon
}


// 3. G√©rer l'affichage dynamique (Coop vs Blitz)
function toggleDurationDisplay() {
    // Cette fonction ne sert maintenant que pour Dictionnario
    // car pour l'Intrus, le select "config-mode" est cach√© mais vaut "blitz"
    const mode = document.getElementById('config-mode').value;
    const durationGroup = document.getElementById('duration-group');
    const desc = document.getElementById('mode-desc');

    if (currentConfigType === 'definition') {
        if (mode === 'blitz') {
            durationGroup.style.display = 'block';
            desc.textContent = "Trouvez un maximum de mots dans le temps imparti.";
        } else {
            durationGroup.style.display = 'none';
            desc.textContent = "Trouvez un mot unique ensemble sans limite de temps.";
        }
    }
}

// 4. Lancer la partie avec les param√®tres choisis
function submitGameConfig() {
    // R√©cup√©ration des valeurs
    // Pour l'intrus, mode sera 'blitz' car on l'a forc√© dans openGameConfig
    const mode = document.getElementById('config-mode').value;
    let duration = 0;

    if (mode === 'blitz') {
        duration = parseInt(document.getElementById('config-duration').value);
    }

    closeConfigModal();
    
    // Lancement universel
    createGame(currentConfigType, mode, duration);
}

function launchDictio() {
    const modeSelect = document.getElementById('dictio-mode').value;
    let mode = 'coop'; // Mode par d√©faut
    let duration = 0;

    if (modeSelect.startsWith('blitz')) {
        mode = 'blitz';
        // On extrait le chiffre (3 ou 5) et on convertit en secondes
        duration = parseInt(modeSelect.split('_')[1]) * 60; 
    }

    createGame('definition', mode, duration);
}

async function createGame(type, mode = 'coop', duration = 0) {
    if (!verifierPseudo()) return;
    const name = document.getElementById('player-name').value;
    if(!name) return showModal("Pseudo Requis", "Identifiez-vous avant de commencer une session.");
    
    const res = await fetch('/rooms', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ player_name: name, game_type: type, mode: mode, duration: duration })
    });
    const data = await res.json();
    window.location.href = `/game?room=${data.room_id}&player=${encodeURIComponent(name)}`;
}

document.getElementById('btn-join').onclick = () => {
    if (!verifierPseudo()) return;
    const name = document.getElementById('player-name').value;
    const room = document.getElementById('room-id').value;
    if(!name || !room) return showModal("Donn√©es Manquantes", "Le pseudo et l'ID de room sont n√©cessaires pour la synchronisation.");
    window.location.href = `/game?room=${room}&player=${encodeURIComponent(name)}`;
};
</script>

<div id="config-modal" class="modal-overlay">
    <div class="modal-box" style="text-align: left; max-width: 450px;">
        <h2 id="config-modal-title" style="text-align: center; margin-bottom: 30px;">Configuration</h2>
        
        <div id="mode-group" style="margin-bottom: 20px;">
            <label style="font-weight:bold; display:block; margin-bottom:10px;">Mode de jeu</label>
            <select id="config-mode" onchange="toggleDurationDisplay()" style="width:100%;">
                <option value="coop">ü§ù Classique (Coop)</option>
                <option value="blitz">‚ö° Blitz (Chrono)</option>
            </select>
        </div>

        <p id="mode-desc" style="font-size: 0.9em; color: var(--text-muted); margin-top: 5px; margin-bottom: 20px;">
            Description du mode...
        </p>

        <div id="duration-group" style="margin-bottom: 30px; display: none;">
            <label style="font-weight:bold; display:block; margin-bottom:10px;">Dur√©e du d√©fi</label>
            <select id="config-duration" style="width:100%;">
                <option value="60">1 minute</option>
                <option value="180" selected>3 minutes</option>
                <option value="300">5 minutes</option>
                <option value="600">10 minutes</option> </select>
        </div>

        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
            <button class="btn" onclick="submitGameConfig()">Lancer</button>
            <button class="btn btn-outline" onclick="closeConfigModal()">Annuler</button>
        </div>
    </div>
</div>

</body>
</html>